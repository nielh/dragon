#ifndef MSR_H
#define MSR_H

#include "kernel.h"

#define MC_ADDR                    0x00000000
#define MC_TYPE                    0x00000001
#define MONITOR_FILTER_SIZE        0x00000006
#define TIME_STAMP_COUNTER         0x00000010
#define PLATFORM_ID                0x00000017
#define APIC_BASE                  0x0000001b
#define EBL_CR_POWERON             0x0000002a
#define FEATURE_CONTROL            0x0000003a
#define LASTBRANCH_0_FROM_IP       0x00000040
#define LASTBRANCH_1_FROM_IP       0x00000041
#define LASTBRANCH_2_FROM_IP       0x00000042
#define LASTBRANCH_3_FROM_IP       0x00000043
#define LASTBRANCH_0_TO_LIP        0x00000060
#define LASTBRANCH_1_TO_LIP        0x00000061
#define LASTBRANCH_2_TO_LIP        0x00000062
#define LASTBRANCH_3_TO_LIP        0x00000063
#define BIOS_UPDT_TRIG             0x00000079
#define BIOS_SIGN_ID               0x0000008b
#define SMM_MONITOR_CTL            0x0000009b
#define PMC0                       0x000000c1
#define PMC1                       0x000000c2
#define PMC2                       0x000000c3
#define PMC3                       0x000000c4
#define FSB_FREQ                   0x000000cd
#define PLATFORM_INFO              0x000000ce
#define MPERF                      0x000000e7
#define APERF                      0x000000e8
#define MTRRCAP                    0x000000fe
#define BBL_CR_CTL3                0x0000011e
#define SYSENTER_CS                0x00000174
#define SYSENTER_ESP               0x00000175
#define SYSENTER_EIP               0x00000176
#define MCG_CAP                    0x00000179
#define MCG_STATUS                 0x0000017a
#define MCG_CTL                    0x0000017b
#define PERFEVTSEL0                0x00000186
#define PERFEVTSEL1                0x00000187
#define PERFEVTSEL2                0x00000188
#define PERFEVTSEL3                0x00000189
#define PERF_STATUS                0x00000198
#define PERF_CTL                   0x00000199
#define CLOCK_MODULATION           0x0000019a
#define THERM_INTERRUPT            0x0000019b
#define THERM_STATUS               0x0000019c
#define THERM2_CTL                 0x0000019d
#define MISC_ENABLE                0x000001a0
#define TEMPERATURE_TARGET         0x000001a2
#define OFFCORE_RSP0               0x000001a6
#define TURBO_RATIO_LIMIT          0x000001ad
#define LBR_SELECT                 0x000001c8
#define LASTBRANCH_TOS             0x000001c9
#define DEBUG_CTL                  0x000001d9
#define LER_FROM_LIP               0x000001dd
#define LER_TO_LIP                 0x000001de
#define PLATFORM_DCA_CAP           0x000001f8
#define MTRR_PHYSBASE0             0x00000200
#define MTRR_PHYSMASK0             0x00000201
#define MTRR_PHYSBASE1             0x00000202
#define MTRR_PHYSMASK1             0x00000203
#define MTRR_PHYSBASE2             0x00000204
#define MTRR_PHYSMASK2             0x00000205
#define MTRR_PHYSBASE3             0x00000206
#define MTRR_PHYSMASK3             0x00000207
#define MTRR_PHYSBASE4             0x00000208
#define MTRR_PHYSMASK4             0x00000209
#define MTRR_PHYSBASE5             0x0000020a
#define MTRR_PHYSMASK5             0x0000020b
#define MTRR_PHYSBASE6             0x0000020c
#define MTRR_PHYSMASK6             0x0000020d
#define MTRR_PHYSBASE7             0x0000020e
#define MTRR_PHYSMASK7             0x0000020f
#define MTRR_FIX64K_00000          0x00000250
#define MTRR_FIX16K_80000          0x00000258
#define MTRR_FIX16K_A0000          0x00000259
#define MTRR_FIX4K_C0000           0x00000268
#define MTRR_FIX4K_C8000           0x00000269
#define MTRR_FIX4K_D0000           0x0000026a
#define MTRR_FIX4K_D8000           0x0000026b
#define MTRR_FIX4K_E0000           0x0000026c
#define MTRR_FIX4K_E8000           0x0000026d
#define MTRR_FIX4K_F0000           0x0000026e
#define MTRR_FIX4K_F8000           0x0000026f
#define CR_PAT                     0x00000277
#define MC0_CTL2                   0x00000280
#define MC1_CTL2                   0x00000281
#define MC2_CTL2                   0x00000282
#define MC3_CTL2                   0x00000283
#define MC4_CTL2                   0x00000284
#define MC5_CTL2                   0x00000285
#define MC6_CTL2                   0x00000286
#define MC7_CTL2                   0x00000287
#define MC8_CTL2                   0x00000288
#define MTRR_DEF_TYPE              0x000002ff
#define FIXED_CTR0                 0x00000309
#define FIXED_CTR1                 0x0000030a
#define FIXED_CTR2                 0x0000030b
#define PERF_CAPABILITIES          0x00000345
#define FIXED_CTR_CTL              0x0000038d
#define PERF_GLOBAL_STATUS         0x0000038e
#define PERF_GLOBAL_CTL            0x0000038f
#define PERF_GLOBAL_OVF_CTL        0x00000390
#define UNCORE_PERF_GLOBAL_CTL     0x00000391
#define UNCORE_PERF_GLOBAL_STATUS  0x00000392
#define UNCORE_PERF_GLOBAL_OVF_CTL 0x00000393
#define UNCORE_FIXED_CTR0          0x00000394
#define UNCORE_FIXED_CTR_CTL       0x00000395
#define UNCORE_ADDR_OPCODE_MATCH   0x00000396
#define UNCORE_PERFEVTSEL0         0x000003b0
#define UNCORE_PERFEVTSEL1         0x000003b1
#define UNCORE_PERFEVTSEL2         0x000003b2
#define UNCORE_PERFEVTSEL3         0x000003b3
#define UNCORE_PERFEVTSEL4         0x000003b4
#define UNCORE_PERFEVTSEL5         0x000003b5
#define UNCORE_PERFEVTSEL6         0x000003b6
#define UNCORE_PERFEVTSEL7         0x000003b7
#define UNCORE_PMC0                0x000003c0
#define UNCORE_PMC1                0x000003c1
#define UNCORE_PMC2                0x000003c2
#define UNCORE_PMC3                0x000003c3
#define UNCORE_PMC4                0x000003c4
#define UNCORE_PMC5                0x000003c5
#define UNCORE_PMC6                0x000003c6
#define UNCORE_PMC7                0x000003c7
#define PEBS_ENABLE                0x000003f1
#define PEBS_LD_LAT                0x000003f6
#define PKG_C3_RESIDENCY           0x000003f8
#define PKG_C6_RESIDENCY           0x000003f9
#define PKG_C7_RESIDENCY           0x000003fa
#define CORE_C3_RESIDENCY          0x000003fc
#define CORE_C6_RESIDENCY          0x000003fd
#define MC0_CTL                    0x00000400
#define MC0_STATUS                 0x00000401
#define MC0_ADDR                   0x00000402
#define MC0_MISC                   0x00000403
#define MC1_CTL                    0x00000404
#define MC1_STATUS                 0x00000405
#define MC1_ADDR                   0x00000406
#define MC1_MISC                   0x00000407
#define MC2_CTL                    0x00000408
#define MC2_STATUS                 0x00000409
#define MC2_ADDR                   0x0000040a
#define MC2_MISC                   0x0000040b
#define MC3_CTL                    0x0000040c
#define MC3_STATUS                 0x0000040d
#define MC3_ADDR                   0x0000040e
#define MC3_MISC                   0x0000040f
#define MC4_CTL                    0x00000410
#define MC4_STATUS                 0x00000411
#define MC4_ADDR                   0x00000412
#define MC4_MISC                   0x00000413
#define MC5_CTL                    0x00000414
#define MC5_STATUS                 0x00000415
#define MC5_ADDR                   0x00000416
#define MC5_MISC                   0x00000417
#define MC6_STATUS                 0x00000419
#define MC7_STATUS                 0x0000041d
#define MC8_STATUS                 0x00000421
#define VMX_BASIC                  0x00000480
#define VMX_PINBASED_CTLS          0x00000481
#define VMX_PROCBASED_CTLS         0x00000482
#define VMX_EXIT_CTLS              0x00000483
#define VMX_ENTRY_CTLS             0x00000484
#define VMX_MISC_CTLS              0x00000485
#define VMX_CR0_FIXED0             0x00000486
#define VMX_CR0_FIXED1             0x00000487
#define VMX_CR4_FIXED0             0x00000488
#define VMX_CR4_FIXED1             0x00000489
#define VMX_VMCS_ENUM              0x0000048a
#define VMX_PROCBASED_CTLS2        0x0000048b
#define VMX_EPT_VPID_CAP           0x0000048c
#define VMX_TRUE_PINBASES_CTLS     0x0000048d
#define VMX_TRUE_PROCBASED_CTLS    0x0000048e
#define VMX_TRUE_EXIT_CTLS         0x0000048f
#define VMX_TRUE_ENTRY_CTLS        0x00000490
#define DS_AREA                    0x00000600
#define EXT_XAPICID                0x00000802
#define EXT_XAPIC_VERSION          0x00000803
#define EXT_XAPIC_TPR              0x00000808
#define EXT_XAPIC_PPR              0x0000080a
#define EXT_XAPIC_EOI              0x0000080b
#define EXT_XAPIC_LDR              0x0000080d
#define EXT_XAPIC_SIVR             0x0000080f
#define EXT_XAPIC_ISR0             0x00000810
#define EXT_XAPIC_ISR1             0x00000811
#define EXT_XAPIC_ISR2             0x00000812
#define EXT_XAPIC_ISR3             0x00000813
#define EXT_XAPIC_ISR4             0x00000814
#define EXT_XAPIC_ISR5             0x00000815
#define EXT_XAPIC_ISR6             0x00000816
#define EXT_XAPIC_ISR7             0x00000817
#define EXT_XAPIC_TMR0             0x00000818
#define EXT_XAPIC_TMR1             0x00000819
#define EXT_XAPIC_TMR2             0x0000081a
#define EXT_XAPIC_TMR3             0x0000081b
#define EXT_XAPIC_TMR4             0x0000081c
#define EXT_XAPIC_TMR5             0x0000081d
#define EXT_XAPIC_TMR6             0x0000081e
#define EXT_XAPIC_TMR7             0x0000081f
#define EXT_XAPIC_IRR0             0x00000820
#define EXT_XAPIC_IRR1             0x00000821
#define EXT_XAPIC_IRR2             0x00000822
#define EXT_XAPIC_IRR3             0x00000823
#define EXT_XAPIC_IRR4             0x00000824
#define EXT_XAPIC_IRR5             0x00000825
#define EXT_XAPIC_IRR6             0x00000826
#define EXT_XAPIC_IRR7             0x00000827
#define EXT_XAPIC_ESR              0x00000828
#define EXT_XAPIC_CMCI             0x0000082f
#define EXT_XAPIC_ICR              0x00000830
#define EXT_XAPIC_LVT_TIMER        0x00000832
#define EXT_XAPIC_LVT_THERMAL      0x00000833
#define EXT_XAPIC_LVT_PMI          0x00000834
#define EXT_XAPIC_LVT_LINT0        0x00000835
#define EXT_XAPIC_LVT_LINT1        0x00000836
#define EXT_XAPIC_LVT_ERROR        0x00000837
#define EXT_XAPIC_INIT_COUNT       0x00000838
#define EXT_XAPIC_CUR_COUNT        0x00000839
#define EXT_XAPIC_DIV_CONF         0x0000083e
#define EXT_XAPIC_SELF_IPI         0x0000083f
#define EMON_L3_CTR_CTL0           0x000107cc
#define EMON_L3_CTR_CTL1           0x000107cd
#define EMON_L3_CTR_CTL2           0x000107ce
#define EMON_L3_CTR_CTL3           0x000107cf
#define EMON_L3_CTR_CTL4           0x000107d0
#define EMON_L3_CTR_CTL5           0x000107d1
#define EMON_L3_CTR_CTL6           0x000107d2
#define EMON_L3_CTR_CTL7           0x000107d3
#define EMON_L3_GL_CTL             0x000107d8
#define EFER                       0xc0000080
#define STAR                       0xc0000081
#define LSTAR                      0xc0000082
#define CSTAR                      0xc0000083
#define FMASK                      0xc0000084
#define FS_BASE                    0xc0000100
#define GS_BASE                    0xc0000101
#define KERNEL_GS_BASE             0xc0000102
#define TSC_AUX                    0xc0000103

static inline u64 rdmsr(u32 msr)
{
    u32 high, low;

    ASM("rdmsr" : "=a"(low), "=d"(high) : "c"(msr));
    return((((u64)high) << 32) + (u64)low);
}

static inline void wrmsr(u32 msr, u64 value)
{
    ASM("wrmsr" :: "a"((u32)value), "d"((u32)(value >> 32)), "c"(msr));
}

#endif// MSR_H
